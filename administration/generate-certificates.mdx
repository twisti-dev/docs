---
title: "Certificate Generation Guide"
description: "Generate and manage SSL/TLS certificates for your Netty-based server and clients using OpenSSL. Properly generated certificates ensure secure communication between your server and clients."
sidebarTitle: "Certificate Generation"
icon: "file-certificate"
---

## Prerequisites

- Install [OpenSSL](https://slproweb.com/products/Win32OpenSSL.html) or use WSL/Git Bash.
- Ensure OpenSSL is available in your terminal:

```bash
openssl version
```

## Step-by-Step Guide

<Note>
  If you already have a server set up and only need to add a new client, skip directly to **Step 4**. Ensure the following files exist in your working directory:

  - `openssl.cnf`
  - `ca.key`
  - `ca.crt`
</Note>

<Steps>
  <Step title="Create an OpenSSL Configuration File">
    Create a file named `openssl.cnf` in your working directory:

    ```powershell
    [ req ]
    default_bits       = 2048
    distinguished_name = req_distinguished_name
    req_extensions     = v3_req
    prompt             = no
    
    [ req_distinguished_name ]
    C  = DE
    ST = Remote
    L  = Internet
    O  = Surf Cloud
    CN = YOUR_SERVER_IP_OR_DNS
    
    [ v3_req ]
    subjectAltName = @alt_names
    keyUsage = critical, digitalSignature, keyEncipherment
    extendedKeyUsage = serverAuth, clientAuth
    
    [ alt_names ]
    IP.1 = YOUR_SERVER_IP
    DNS.1 = YOUR_SERVER_DNS
    ```

    Replace `YOUR_SERVER_IP` and `YOUR_SERVER_DNS` with your actual server IP address and DNS name.

    <Accordion title="Example" icon="book-open-reader">
      ```powershell
      CN = 192.168.1.23
      
      [ alt_names ]
      IP.1 = 192.168.1.23
      DNS.1 = myserver.local
      ```
    </Accordion>
  </Step>
  <Step title="Generate a Certificate Authority (CA)">
    Run these commands once to create your CA:

    ```shellscript
    openssl genrsa -out ca.key 2048
    openssl req -x509 -new -nodes -key ca.key -sha256 -days 3650 -out ca.crt -subj "/C=DE/ST=Remote/L=Internet/O=Surf Cloud/CN=SurfCloud CA"
    ```

    <Warning>
      - `ca.key`: Private key of your CA (keep secret and safe).
      - `ca.crt`: Public certificate of your CA (used by clients and server to establish trust).
    </Warning>
  </Step>
  <Step title="Generate a Server Certificate">
    ```shellscript
    # Generate private key
    openssl genrsa -out server.key 2048
    
    # Generate CSR (Certificate Signing Request)
    openssl req -new -key server.key -out server.csr -config openssl.cnf
    
    # Sign CSR with your CA
    openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days 365 -extfile openssl.cnf -extensions v3_req
    ```

    **Files Produced:**

    - `server.key`: Server private key (use on your Netty server).
    - `server.crt`: Server certificate (distribute to clients).
  </Step>
  <Step title="Generate Client Certificates (repeat for each client)">
     Update `openssl.cnf` by changing the `CN` value to your client name (for example, `client01`, `client02`).

    ```powershell
    CN = test-server01
    ```

    Then run:

    ```powershell
    openssl genrsa -out client.key 2048
    openssl req -new -key client.key -out client.csr -config openssl.cnf
    openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out client.crt -days 365 -extfile openssl.cnf -extensions v3_req
    ```

    **Files produced:**

    - `client.key`: Client private key (keep secret and only on the client).
    - `client.crt`: Client certificate (signed by CA).
  </Step>
</Steps>

## File Management

### Files to Keep and Their Purpose

| File         | Purpose                                      | Store on                             |
| ------------ | -------------------------------------------- | ------------------------------------ |
| `ca.key`     | CA private key (needed for signing)          | Secure offline storage (never share) |
| `ca.crt`     | CA certificate (trusted by all participants) | Server and Clients                   |
| `server.key` | Server private key                           | Server (secure)                      |
| `server.crt` | Server certificate (signed by CA)            | Server (share with clients)             |
| `client.key` | Client private key                           | Client private key                   |
| `client.crt` | Client certificate (signed by CA)            | Client                                 |

### Directory Structure

**On Server:**

```
certificates/
├── server.key
├── server.crt
└── ca.crt
```

**On Client:**

```
certificates/
├── client.key
├── client.crt
└── ca.crt
```